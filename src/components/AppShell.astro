---
import Sidebar from "./Sidebar.astro";
import ThemeToggle from "./ThemeToggle.astro";
import BurgerMenu from "./BurgerMenu.astro";

export interface Props {
  sidebarInitiallyOpen?: boolean;
}

const { sidebarInitiallyOpen = true } = Astro.props;
---

<div class="bg-base-100 min-h-screen font-montserrat">
  <Sidebar />
  <BurgerMenu />
  <div class="absolute top-6 right-6">
    <ThemeToggle />
  </div>
  <main id="main-content" class="transition-[padding] duration-300 ease-in-out">
    <slot />
  </main>
</div>

<script define:vars={{ sidebarInitiallyOpen }}>
  const body = document.body;
  const burgerMenu = document.getElementById("burger-menu");
  const sidebar = document.getElementById("sidebar");
  const mainContent = document.getElementById("main-content");
  const burgerIcon = document.getElementById("burger-icon");
  const closeIcon = document.getElementById("close-icon");

  const openSidebar = () => {
    sidebar?.classList.remove("-translate-x-full");
    sidebar?.classList.add("translate-x-0");
    mainContent?.classList.add("lg:pl-48");
    burgerIcon?.classList.add("hidden");
    closeIcon?.classList.remove("hidden");
    body.classList.add("sidebar-open");
    body.classList.remove("sidebar-closed");
  };

  const closeSidebar = () => {
    sidebar?.classList.add("-translate-x-full");
    sidebar?.classList.remove("translate-x-0");
    mainContent?.classList.remove("lg:pl-48");
    burgerIcon?.classList.remove("hidden");
    closeIcon?.classList.add("hidden");
    body.classList.remove("sidebar-open");
    body.classList.add("sidebar-closed");
  };

  const isSidebarOpen = () => {
    return sidebar?.classList.contains("translate-x-0");
  };

  function setSidebarState(isOpen) {
    if (isOpen) {
      openSidebar();
    } else {
      closeSidebar();
    }
  }

  function toggleSidebar() {
    const isOpen = sidebar?.classList.contains("translate-x-0");
    setSidebarState(!isOpen);
  }

  document.addEventListener("DOMContentLoaded", () => {
    if (sidebarInitiallyOpen) {
      if (window.innerWidth >= 1024) {
        setSidebarState(true);
      } else {
        setSidebarState(false);
      }
    } else {
      setSidebarState(false);
    }
  });

  burgerMenu?.addEventListener("click", toggleSidebar);

  const navLinks = sidebar?.querySelectorAll("a");
  navLinks?.forEach((link) => {
    link.addEventListener("click", () => {
      if (window.innerWidth < 1024) {
        if (isSidebarOpen()) {
          toggleSidebar();
        }
      }
    });
  });
</script>
