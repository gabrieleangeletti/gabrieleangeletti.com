---
import Layout from "../../layouts/Layout.astro";
import AppShell from "../../components/AppShell.astro";
import { loadBlogPosts } from "../../data/blog";

// Load all published posts
const allPosts = loadBlogPosts();
const publishedPosts = allPosts
  .filter((post) => post.status === "published")
  .sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());

// Utility function to generate consistent colors for tags
const getTagColor = (tag: string): string => {
  const colors = [
    "badge-primary",
    "badge-secondary",
    "badge-accent",
    "badge-info",
    "badge-success",
    "badge-warning",
    "badge-error",
  ];

  // Simple hash function to consistently map tags to colors
  let hash = 0;
  for (let i = 0; i < tag.length; i++) {
    hash = ((hash << 5) - hash + tag.charCodeAt(i)) & 0xffffffff;
  }
  return colors[Math.abs(hash) % colors.length];
};

const formatDate = (date: Date): string => {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
};
---

<Layout
  title="Blog - Gabriele Angeletti"
  description="Thoughts on software engineering, technology, and building great products. Read about clean code, scalable applications, and best practices."
>
  <AppShell>
    <div id="blog" class="p-12">
      <div class="max-w-4xl mx-auto">
        <h1 class="text-4xl font-bold text-base-content mb-2">Blog</h1>
        <p class="text-base-content/60 mb-12">
          Thoughts on software engineering, technology, and building great products.
        </p>

        <div class="space-y-8">
          {
            publishedPosts.map((post) => (
              <div class="card bg-base-100 shadow-lg hover:shadow-xl transition-shadow duration-300">
                <div class="card-body">
                  <div class="flex flex-wrap gap-2 mb-4">
                    {post.tags.map((tag) => (
                      <a
                        href={`/blog/tag/${tag}`}
                        class={`badge ${getTagColor(tag)} badge-sm hover:scale-105 transition-transform cursor-pointer`}
                      >
                        {tag}
                      </a>
                    ))}
                  </div>

                  <a href={`/blog/${post.slug}`} class="hover:text-primary transition-colors">
                    <h2 class="card-title text-2xl font-bold text-base-content mb-3">
                      {post.title}
                    </h2>
                  </a>

                  <div class="flex items-center gap-2 text-sm text-base-content/60 mb-4">
                    {post.author && (
                      <>
                        <span>By {post.author}</span>
                        <span>â€¢</span>
                      </>
                    )}
                    <span>{formatDate(post.timestamp)}</span>
                  </div>

                  <p class="text-base-content/80 leading-relaxed mb-4">
                    {post.excerpt || post.content.substring(0, 200) + "..."}
                  </p>

                  <div class="card-actions justify-end">
                    <a href={`/blog/${post.slug}`} class="btn btn-primary btn-sm">
                      Read More
                    </a>
                  </div>
                </div>
              </div>
            ))
          }
        </div>

        {
          publishedPosts.length === 0 && (
            <div class="text-center py-12">
              <p class="text-base-content/60 text-lg">No published posts yet. Check back soon!</p>
            </div>
          )
        }
      </div>
    </div>
  </AppShell>
</Layout>

